<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<title>Wasm trace</title>
</head>

<body>
	<div>
		<button onClick="run();" id="runButton" disabled>Run</button>
		progress: <span id="progress"></span>%
	</div>
	<canvas id="canvas"></canvas>

	<script>

		const width = 800;
		const height = 450;

		let canvas = document.getElementById('canvas');
		let ctx = canvas.getContext('2d');
		canvas.width = width;
		canvas.height = height;

		var traceWorker = new Worker('traceWorker.js');
		traceWorker.onerror = function(event) {
			console.log('There is an error in trace worker: ' + event);
		}
		traceWorker.onmessage = function(e) {
			if (e.data.type === "init") {
				document.getElementById("runButton").disabled = false;

			} else if (e.data.type === "image") {
				let imageArray = new Uint8ClampedArray(e.data.buffer)
				let imageData = new ImageData(imageArray, width, height);
				ctx.putImageData(imageData, 0, 0);

				let p = document.getElementById("progress");
				p.innerText = (e.data.progress * 100).toFixed(1)
			}
		}

		function run() {
			document.getElementById("runButton").disabled = true;

			traceWorker.postMessage({
				width: width,
				height: height
			})			
		}
	</script>

</body>

</html>